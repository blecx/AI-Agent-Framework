# Step 3 — Hardening with strict token-budgeted issue specs.
# Constraint: each issue body stays compact to fit free-tier execution models.

AI-Agent-Framework:
  - number: "S3-BE-01"
    size_estimate: "S"
    title: "Step 3 — TUI deterministic E2E spine baseline (backend)"
    labels:
      - step:3
      - tests/e2e
      - backend/tui
      - size:S
    body: |
      ## Goal / Problem Statement
      Add a minimal deterministic TUI E2E baseline so CI can run one stable end-to-end workflow.

      ## Scope
      ### In Scope
      - Add one backbone E2E scenario under `tests/e2e/tui/`.
      - Add deterministic helper fixture/wait utilities (no sleep-based timing).
      - Add `tests/README.md` section for TUI E2E run instructions.
      ### Out of Scope
      - Full multi-scenario suite expansion.
      - New product features.
      ### Dependencies
      - Existing TUI command flows.

      ## Acceptance Criteria
      - [ ] `tests/e2e/tui/test_workflow_spine.py` exists and runs in CI.
      - [ ] Test is deterministic across 3 consecutive local runs.
      - [ ] `tests/README.md` includes setup + run command.

      ## Technical Approach
      - Create one focused workflow-spine test and shared deterministic helper.
      - Keep fixtures local to `tests/e2e/tui/`.

      ## Testing Requirements
      - `pytest tests/e2e/tui/test_workflow_spine.py -q`
      - `pytest tests/e2e/tui/test_workflow_spine.py -q -x`

      ## Documentation Updates
      - [ ] Update `tests/README.md` with TUI E2E baseline instructions.

      ## Cross-Repository Coordination
      None.

  - number: "S3-BE-02"
    size_estimate: "S"
    title: "Step 3 — Cross-artifact audit rule pack v1 (backend)"
    labels:
      - step:3
      - backend/api/tui
      - size:S
    body: |
      ## Goal / Problem Statement
      Implement a small first pack of cross-artifact audit checks with deterministic outputs.

      ## Scope
      ### In Scope
      - Add 2-3 high-value rules (reference consistency + date consistency).
      - Ensure deterministic error ordering/messages.
      - Add unit tests for each new rule.
      ### Out of Scope
      - Full audit engine redesign.
      - Bulk multi-project auditing.
      ### Dependencies
      - Existing audit service/rule interfaces.

      ## Acceptance Criteria
      - [ ] New rules execute in current audit flow.
      - [ ] Rule outputs are deterministic for identical input.
      - [ ] Unit tests cover pass/fail paths.

      ## Technical Approach
      - Extend current audit rule registry with compact rule implementations.
      - Normalize result sorting before return.

      ## Testing Requirements
      - `pytest tests/unit -k "audit and cross" -q`
      - `pytest tests/integration -k audit -q`

      ## Documentation Updates
      - [ ] Add short rule summary to `docs/` audit documentation.

      ## Cross-Repository Coordination
      None.

  - number: "S3-BE-03"
    size_estimate: "S"
    title: "Step 3 — Backend CI gate for test-doc freshness"
    labels:
      - step:3
      - ci/cd
      - docs
      - size:S
    body: |
      ## Goal / Problem Statement
      Prevent drift between backend test layout and `tests/README.md` by enforcing a CI gate.

      ## Scope
      ### In Scope
      - Add a lightweight check script for required README sections/paths.
      - Wire script into CI quality gates.
      - Provide actionable failure messages.
      ### Out of Scope
      - Full doc style linting platform.
      - Cross-repo documentation checks.
      ### Dependencies
      - Existing backend CI workflow.

      ## Acceptance Criteria
      - [ ] CI fails when required test-doc sections are missing.
      - [ ] CI passes when docs are aligned.
      - [ ] Local command is documented for contributors.

      ## Technical Approach
      - Add deterministic checker script under `scripts/`.
      - Add focused CI step with explicit remediation text.

      ## Testing Requirements
      - `./.venv/bin/python scripts/<checker>.py`
      - `pytest tests/unit -k "doc or checker" -q`

      ## Documentation Updates
      - [ ] Update `tests/README.md` and `docs/development.md` with gate usage.

      ## Cross-Repository Coordination
      None.

AI-Agent-Framework-Client:
  - number: "S3-UX-01"
    size_estimate: "S"
    title: "Step 3 — Client E2E happy-path baseline"
    labels:
      - step:3
      - tests/e2e
      - webui/ux
      - size:S
    body: |
      ## Goal / Problem Statement
      Add one deterministic client E2E happy-path scenario to establish a stable baseline.

      ## Scope
      ### In Scope
      - Add one end-to-end happy-path test under `tests/e2e/`.
      - Capture failure screenshot/log artifact.
      - Document local/CI run command.
      ### Out of Scope
      - Full workflow matrix coverage.
      ### Dependencies
      - Existing client test harness.

      ## Acceptance Criteria
      - [ ] Baseline E2E test runs headless in CI.
      - [ ] Failure artifacts are captured.
      - [ ] Docs updated.

      ## Technical Approach
      - Create one stable scenario with deterministic waits.

      ## Testing Requirements
      - `npm --prefix client run test:e2e -- --grep baseline`

      ## Documentation Updates
      - [ ] Update client `tests/README.md`.

      ## Cross-Repository Coordination
      May require backend test fixtures alignment.

  - number: "S3-UX-02"
    size_estimate: "S"
    title: "Step 3 — Client validation/error pattern hardening v1"
    labels:
      - step:3
      - webui/ux
      - size:S
    body: |
      ## Goal / Problem Statement
      Standardize a small set of client validation/error handling patterns for consistent UX.

      ## Scope
      ### In Scope
      - Normalize validation message rendering for one core form flow.
      - Add network error fallback messaging for one API path.
      - Add focused tests.
      ### Out of Scope
      - Whole-app validation rewrite.
      ### Dependencies
      - Current form/error utility modules.

      ## Acceptance Criteria
      - [ ] Selected form path has consistent validation UX.
      - [ ] One API error path has deterministic fallback handling.
      - [ ] Tests cover success + error scenarios.

      ## Technical Approach
      - Reuse existing utility abstractions; no new framework.

      ## Testing Requirements
      - `npm --prefix client run test -- --runInBand`

      ## Documentation Updates
      - [ ] Update usage notes in client README/docs.

      ## Cross-Repository Coordination
      None.

  - number: "S3-UX-03"
    size_estimate: "S"
    title: "Step 3 — Client CI gate for test-doc freshness"
    labels:
      - step:3
      - ci/cd
      - docs
      - size:S
    body: |
      ## Goal / Problem Statement
      Add a client CI guard that fails when test docs and test structure diverge.

      ## Scope
      ### In Scope
      - Add lightweight docs checker script.
      - Wire checker into client CI.
      - Add remediation guidance in failure output.
      ### Out of Scope
      - Full documentation lint framework.
      ### Dependencies
      - Existing client CI workflow.

      ## Acceptance Criteria
      - [ ] CI gate fails for stale/missing test-doc sections.
      - [ ] CI gate passes when docs are current.
      - [ ] Local command is documented.

      ## Technical Approach
      - Implement deterministic checker with a small required-section contract.

      ## Testing Requirements
      - `npm --prefix client run check:docs`

      ## Documentation Updates
      - [ ] Update client `README.md` and test docs.

      ## Cross-Repository Coordination
      None.
